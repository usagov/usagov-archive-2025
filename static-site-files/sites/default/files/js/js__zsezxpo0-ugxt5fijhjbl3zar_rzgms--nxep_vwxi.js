/* @license GPL-2.0-or-later https://www.drupal.org/licensing/faq */
jQuery(document).ready(function(){"use strict";var imageMap={'icon-about':'/themes/custom/usagov/images/topics/ICONS_Reimagined_About_the_US_and_Its_Government.svg','icon-laws':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Laws_and_Legal_Issues.svg','icon-money':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Money.svg','icon-benefits':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Benefits.svg','icon-immigration':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Immigration.svg','icon-voting':'/themes/custom/usagov/images/topics/ICONS_Voting_and_elections_patriotic.svg','icon-military':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Military_and_Veterans.svg','icon-travel':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Travel.svg','icon-education':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Education.svg','icon-housing':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Housing.svg','icon-disasters':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Disasters_and_Emergencies.svg','icon-covid19':'/themes/custom/usagov/images/topics/ICONS_Reimagined_COVID19.svg','icon-health':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Health.svg','icon-scams':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Scams_and_Fraud.svg','icon-disability':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Disability_Services.svg','icon-jobs':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Jobs_and_Unemployment.svg','icon-business':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Small_Business.svg','icon-taxes':'/themes/custom/usagov/images/topics/ICONS_Reimagined_Taxes.svg','icon-complaints':'/themes/custom/usagov/images/topics/ICONS_Complaints.svg','icon-life-events':'/themes/custom/usagov/images/topics/ICONS_Life_events.svg'};let options={"rootMargin":"0px","threshold":0.001};const lazyLoadingObserver=new IntersectionObserver((elements)=>{elements.forEach((element)=>{if(element.isIntersecting){var className,baseURL,relativePath,bg;className=element.target.getAttribute('data-bg');baseURL=window.location.origin;relativePath=imageMap[className];if(relativePath)bg=`url(${baseURL}${relativePath})`;if(bg&&bg!=='none'){element.target.style.backgroundImage=bg;lazyLoadingObserver.unobserve(element.target);}}});},options);for(const imgClass in imageMap)if(imageMap.hasOwnProperty(imgClass)){var imageElement=document.getElementsByClassName(`${imgClass} lazyload`)[0];if(imageElement)lazyLoadingObserver.observe(imageElement);}});;
function Pagination(total,current,assetBase,labels,onClick){"use strict";this.total=total;this.current=current;this.preCurrent=null;this.assetBase=assetBase;this.labels=labels;this.onClick=onClick;this.nav=null;let myself=this;myself.pageLinks=[];this.getNumericRange=function(){let startAt,stopAt;if(this.current<=4){startAt=2;stopAt=Math.min(5,this.total-1);}else if(this.current>this.total-4){startAt=Math.max(2,this.total-4);stopAt=Math.max(1,this.total-1);}else{startAt=this.current-1;stopAt=this.current+1;}return {"startAt":startAt,"stopAt":stopAt};};this.handlePageClick=function(num,link){myself.setCurrentPage(num);myself.updatePageLinks(link);myself.onClick(num);};this.makeLink=function(className,innerHTML){const link=document.createElement('li');link.className=className;link.innerHTML=innerHTML;return link;};this.makeNextLink=function(){let link=this.makeLink("usa-pagination__item usa-pagination__arrow",`<a href="javascript:void(0)" class="usa-pagination__link usa-pagination__next-page"
       aria-label="${this.labels.nextAria}"
    ><span class="usa-pagination__link-text">${this.labels.next}</span><svg class="usa-icon" aria-hidden="true" role="presentation">
          <use xlink:href="${this.assetBase}/assets/img/sprite.svg#navigate_next"></use>
        </svg></a>`);link.addEventListener('click',function(){let num=myself.current+1;myself.handlePageClick(num,link);});if(myself.current===myself.total)myself.hideElement(link);return link;};this.makePageLink=function(num,isLast){let link=this.makeLink("usa-pagination__item usa-pagination__page-no",`<a
        href="javascript:void(0);"
        class="usa-pagination__button"
        aria-label="${this.labels.page} ${num}"
        >${num}</a>`);link.querySelector('a').addEventListener('click',function(ev){const link=ev.target;const num=parseInt(link.innerText);myself.handlePageClick(num,link);});let atag=link.querySelector('a');if(num===this.current){atag.classList.add('usa-current');atag.setAttribute('aria-current','page');}if(isLast)atag.setAttribute('aria-label',myself.labels.lastPageAria+", "+atag.getAttribute('aria-label'));return link;};this.makePreviousLink=function(){let link=this.makeLink("usa-pagination__item usa-pagination__arrow",`<a href="javascript:void(0)" class="usa-pagination__link usa-pagination__previous-page"
       aria-label="${this.labels.previousAria}"
    ><svg class="usa-icon" aria-hidden="true" role="presentation">
          <use xlink:href="${this.assetBase}/assets/img/sprite.svg#navigate_before"></use>
        </svg>
        <span class="usa-pagination__link-text">${this.labels.previous}</span></a>`);link.addEventListener('click',function(ev){let num=myself.current-1;myself.handlePageClick(num,link);});if(this.current===1)myself.hideElement(link);return link;};this.makeSpacer=function(isDisplayed){let link=this.makeLink('usa-pagination__item usa-pagination__overflow','<span>…</span>');if(isDisplayed===false)myself.hideElement(link);link.setAttribute('aria-label',"ellipsis indicating non-visible pages");return link;};this.setCurrentPage=function(num){myself.preCurrent=myself.current;myself.current=num;const prev=myself.nav.querySelector('a.usa-pagination__previous-page').parentNode;if(num===1)myself.hideElement(prev);else myself.showElement(prev);const next=myself.nav.querySelector('a.usa-pagination__next-page').parentNode;if(num===myself.total)myself.hideElement(next);else myself.showElement(next);if(myself.firstSpacer)if(num>4)myself.showElement(myself.firstSpacer);else myself.hideElement(myself.firstSpacer);if(myself.lastSpacer)if(num<=this.total-4&&myself.total>6)myself.showElement(myself.lastSpacer);else myself.hideElement(myself.lastSpacer);};this.getNextSiblingKey=function(num){let keys=[];for(const key in myself.pageLinks)if(parseInt(key)>num)keys.push(key);if(keys.length>0)return keys[0];return null;};this.hideElement=function(elt){elt.classList.add('display-none');};this.showElement=function(elt){elt.classList.remove('display-none');};this.render=function(){let nav=document.createElement('nav');nav.className="usa-pagination";nav.setAttribute('aria-label',this.labels.navAria);let list=document.createElement('ul');list.className='usa-pagination__list';myself.list=list;const pages=this.getNumericRange();list.append(this.makePreviousLink());list.append(this.makePageLink(1,false));if(myself.total>6){myself.firstSpacer=this.makeSpacer(pages.startAt>2);list.append(myself.firstSpacer);}for(let i=pages.startAt;i<=pages.stopAt;i++){myself.pageLinks[i]=this.makePageLink(i,false);list.append(myself.pageLinks[i]);}if(myself.total>6){myself.lastSpacer=this.makeSpacer(pages.stopAt<this.total-1);list.append(myself.lastSpacer);}if(this.total>1){myself.lastPage=this.makePageLink(this.total,true);list.append(myself.lastPage);}list.append(this.makeNextLink());nav.append(list);this.nav=nav;return nav;};this.updatePageLinks=function(link){const pages=this.getNumericRange();for(let i in myself.pageLinks)if(i<pages.startAt||i>pages.stopAt)this.hideElement(myself.pageLinks[i]);for(let i=pages.startAt;i<=pages.stopAt;i++)if(myself.pageLinks[i])this.showElement(myself.pageLinks[i]);else{myself.pageLinks[i]=this.makePageLink(i,false);if(i<=myself.preCurrent&&i<myself.total-4){const nextSibling=this.getNextSiblingKey(i);if(nextSibling)myself.pageLinks[nextSibling].insertAdjacentElement('beforebegin',myself.pageLinks[i]);}else myself.lastSpacer.insertAdjacentElement('beforebegin',myself.pageLinks[i]);}const current=link.parentElement.parentElement.querySelector('li > a[class*="usa-current"]');;current.classList.remove('usa-current');current.removeAttribute('aria-current');const pageLinks=link.parentElement.parentElement.querySelectorAll('li.usa-pagination__page-no > a');;pageLinks.forEach(function(link){if(link.innerText===myself.current.toString()){link.classList.add('usa-current');link.setAttribute('aria-current','page');}});};};
function BenefitSearch(benefitsPath,lifeEventsPath,assetBase,docLang,labels,form,resultsContainer,perPage){"use strict";this.benefitsSrc=benefitsPath;this.life=lifeEventsPath;this.assetBase=assetBase;this.docLang=docLang;this.labels=labels;this.resultsContainer=resultsContainer;this.form=form;this.perPage=perPage;this.activePage=null;this.terms=[];this.boxes=this.form.querySelectorAll('input[type="checkbox"]:not([value="all"])');this.toggleAll=this.form.querySelector('input[type="checkbox"][value="all"]');let myself=this;this.clearErrors=function(){myself.form.querySelector('.alert-container').innerHTML='';myself.form.querySelector('div[role="group"]').classList.remove('benefits-category-error');};this.fetchBenefits=async function(){const response=await fetch(myself.benefitsSrc);if(!response.ok)throw new Error('Error fetching benefits '+response.status);return await response.json();};this.fetchLifeEvents=async function(){const response=await fetch(myself.life);if(!response.ok)throw new Error('Error fetching benefits '+response.status);const raw=await response.json();let lifeEvents=new Map();for(const lifeEvent of raw)if(lifeEvents.has(lifeEvent.nid)){let existing=lifeEvents.get(lifeEvent.nid);existing.tid.push(lifeEvent.tid);existing.terms.push(lifeEvent.name);lifeEvents.set(lifeEvent.nid,existing);}else{lifeEvent.tid=[lifeEvent.tid];lifeEvent.terms=[lifeEvent.name];lifeEvents.set(lifeEvent.nid,lifeEvent);}return lifeEvents;};this.findMatches=function(){let matches=myself.benefits.filter((item)=>{let numMatches=item.field_benefits_category.filter((value)=>myself.terms.includes(value));return numMatches.length>0;});matches=matches.map(myself.getItemWeight);matches=matches.sort(myself.compareResults);if(!myself.areAllChecked()){for(const [,lifeEvent] of myself.lifeEvents)if(myself.lifeEventHasTopic(lifeEvent.tid,myself.terms))matches.unshift(lifeEvent);}return matches;};this.getItemWeight=function(item){let base=parseInt(item.field_benefit_search_weight);item.weight=isNaN(base)?0:base;return item;};this.compareResults=function(a,b){if(a.weight>b.weight)return -1;if(a.weight<b.weight)return +1;return 0;};this.lifeEventHasTopic=function(tids,terms){for(const tid of tids)if(terms.includes(tid))return true;return false;};this.handleClear=function(announceClear=false){myself.clearErrors();if(announceClear){let alert=myself.form.querySelector('.alert-container');alert.innerHTML=`<div class="visuallyhidden">${myself.labels.selectionsCleared}</div>`;}myself.resultsContainer.innerHTML='';};this.handlePagerClick=function(page){myself.setActivePage(page);myself.updateHistory();};this.parseUrlState=function(){const url=new URL(window.location.href);let page=url.searchParams.get('pg');let terms=url.searchParams.get('t');if(page&&/^\d+$/.test(page))myself.setActivePage(parseInt(page));else myself.setActivePage(1);if(terms){terms=terms.split('-');myself.setTerms(terms);}};this.handleSubmit=function(){myself.clearErrors();let checked=myself.form.querySelectorAll('input[type="checkbox"]:checked');if(checked.length===0){myself.showError();return;}myself.handleClear();myself.terms=Array.from(checked).map((elt)=>{return elt.value;});myself.showResults();myself.updateHistory();if(dataLayer!=null)dataLayer.push({'event':'category_apply_success'});};this.handleToggleCheck=function(){myself.handleClear();myself.setActivePage(1);myself.toggleAll.checked=myself.areAllChecked();};this.handleToggleAll=function(ev){myself.clearErrors();const announceClear=myself.areAllChecked();myself.handleClear(announceClear);myself.setActivePage(1);let newState=ev.target.checked;for(const box of myself.boxes)box.checked=newState;};this.areAllChecked=function(){for(const box of myself.boxes)if(box.checked===false)return false;return true;};this.areAnyChecked=function(){for(const box of myself.boxes)if(box.checked===true)return true;return false;};this.hidePage=function(page){page.classList.remove('page-active');page.classList.add('display-none');};this.markCheckboxColumns=function(){let lastCheckbox=null,lastPos=null,lastListItem=null;for(const box of myself.boxes){let pos=box.getBoundingClientRect();let listItem=box.parentElement.parentElement;if(listItem&&listItem.classList.contains('end-column'))listItem.classList.remove('end-column');if(lastPos&&pos.top<lastPos.top)lastListItem.classList.add('end-column');lastCheckbox=box;lastPos=pos;lastListItem=listItem;}lastListItem.classList.add('end-column');};this.preparePages=function(matches){const total=matches.length;return Array.from({"length":Math.ceil(total/myself.perPage)},function(v,i){let page={"totalItems":total,"first":i*myself.perPage+1,"last":i*myself.perPage+myself.perPage,"matches":matches.slice(i*myself.perPage,i*myself.perPage+myself.perPage)};if(page.last>=total)page.last=total;return page;});};this.renderMatch=function(benefit){let elt=document.createElement('template');let description='';if(benefit.field_short_description)description=benefit.field_short_description;else{if(benefit.field_page_intro)description=benefit.field_page_intro;}switch(benefit.type){case 'Life Event':{let termMarkup='';benefit.terms.forEach((term)=>termMarkup+=`<li>${term}</li>`);elt.innerHTML+=`<div class="grid-row benefits-result">
<div class="desktop:grid-col-8 benefits-result-text">
  <h3><a href="${benefit.view_node}" data-analytics="category-results-links" hreflang="${myself.docLang}">${benefit.field_b_search_title}</a></h3>
  <p>${description}</p></div>
<div class="desktop:grid-col-4 benefits-result-categories"><h4>${myself.labels.appliedCategories}</h4>
  <ul>
  <li>${myself.labels.benefitFinderCategory}</li><li>${myself.labels.lifeEventsCategory}</li>${termMarkup}</div>
  </ul>
</div>`;break;}case 'Basic Page':default:elt.innerHTML+=`<div class="grid-row benefits-result">
<div class="desktop:grid-col-8 benefits-result-text">
  <h3><a href="${benefit.view_node}" data-analytics="category-results-links" hreflang="${myself.docLang}">${benefit.title}</a></h3>
  <p>${description}</p></div>
<div class="desktop:grid-col-4 benefits-result-categories"><h4>${myself.labels.appliedCategories}</h4>
${benefit.term_node_tid}
</div>
</div>`;}return elt;};this.renderPage=function(page,index){let elt=document.createElement('div');elt.className=index+1===myself.activePage?'page page-active':'page display-none';elt.setAttribute('data-page',index+1);let label=myself.labels.showingResults.replace('@first@',page.first).replace('@last@',page.last).replace('@totalItems@',page.totalItems);elt.innerHTML+=`<h2 tabindex="-1">${label}</h2>`;for(const benefit of page.matches)elt.innerHTML+=myself.renderMatch(benefit).innerHTML;return elt;};this.setActivePage=function(num){if(num===this.activePage)return;this.activePage=num;const pages=this.resultsContainer.querySelectorAll('.page');if(pages.length>0){for(const page of pages)if(parseInt(page.getAttribute('data-page'))===this.activePage)this.showPage(page);else this.hidePage(page);myself.scrollAndFocusResults();}};this.scrollAndFocusResults=function(){myself.resultsContainer.scrollIntoView({"behavior":'auto'});myself.resultsContainer.querySelector('.page-active > h2').focus();};this.setTerms=function(terms){terms=terms.filter((item)=>{return /^\d+$/.test(item);});terms.sort();if(terms===this.terms)return;this.terms=terms;for(let box of myself.boxes)box.checked=this.terms.includes(box.getAttribute('value'));this.handleSubmit();};this.showError=function(){let alert=myself.form.querySelectorAll('.usa-alert');if(alert.length>0)return;let elt=document.createElement('template');elt.innerHTML=`<div class="usa-alert usa-alert--slim usa-alert--error margin-bottom-4">
        <div class="usa_alert__body" data-analytics="errorMessage">
           <h3 tabindex="-1" class="usa-alert__heading padding-left-6">${myself.labels.emptyCategoryError}</h3>
        </div>
    </div>`;let container=myself.form.querySelector('.alert-container');container.prepend(elt.content);const fieldset=myself.form.querySelector('div[role="group"]');fieldset.classList.add('benefits-category-error');container.querySelector('.usa-alert__heading').focus();if(dataLayer!=null&&document.querySelector('[data-analytics="errorMessage"]'))dataLayer.push({'event':'category_apply_error'});};this.showPage=function(page){page.classList.add('page-active');page.classList.remove('display-none');};this.showResults=function(){myself.resultsContainer.innerHTML='';let matches=this.findMatches();const pages=myself.preparePages(matches);for(const page of pages.map(myself.renderPage))myself.resultsContainer.innerHTML+=page.outerHTML;if(myself.activePage>pages.length)myself.setActivePage(pages.length);else{if(myself.activePage<1)myself.setActivePage(1);}myself.scrollAndFocusResults();myself.showPager(pages.length);};this.showPager=function(maxPages){if(maxPages<2)return;const pager=new Pagination(maxPages,myself.activePage,myself.assetBase,myself.labels,myself.handlePagerClick);let existing=resultsContainer.querySelector('nav.usa-pagination');if(existing){existing.remove();resultsContainer.append(pager.render());return;}resultsContainer.append(pager.render());};this.updateHistory=function(){const terms=myself.terms.filter((num)=>{return false===isNaN(num);});const url=new URL(window.location.href);url.searchParams.set('t',terms.join('-'));url.searchParams.set('pg',myself.activePage);let newUrl=url.toString();if(newUrl!==window.location.href)window.history.pushState(null,'',newUrl);};this.init=async function(){this.benefits=await myself.fetchBenefits();this.lifeEvents=await myself.fetchLifeEvents();this.parseUrlState();this.toggleAll.addEventListener('click',myself.handleToggleAll);for(const box of myself.boxes)box.addEventListener('click',myself.handleToggleCheck);this.toggleAll.checked=myself.areAllChecked();myself.form.addEventListener('submit',myself.handleSubmit);myself.form.addEventListener('reset',function(){myself.handleClear(myself.areAnyChecked());});window.addEventListener('popstate',myself.parseUrlState);this.markCheckboxColumns();window.addEventListener('resize',myself.markCheckboxColumns);};}jQuery(document).ready(async function(){"use strict";let docLang=[document.documentElement.lang];let benefitsPath,lifeEventsPath,labels;if(docLang[0]==='en'){benefitsPath="../_data/benefits-search/en/pages.json";lifeEventsPath="../_data/benefits-search/en/life-events.json";labels={'showingResults':'@first@&ndash;@last@ of @totalItems@ results','page':"page",'next':"Next",'nextAria':"Next page",'previous':"Previous",'previousAria':"Previous page",'navAria':"Pagination",'lastPageAria':'Last page','emptyCategoryError':'Error: Please select at least one or more categories','appliedCategories':'Applied categories','lifeEventsCategory':'Life events','benefitFinderCategory':'Benefit finder tool','selectionsCleared':'Your selections were cleared.'};}else{if(docLang[0]==='es'){benefitsPath="../../_data/benefits-search/es/pages.json";lifeEventsPath="../../_data/benefits-search/es/life-events.json";labels={'showingResults':'@first@&ndash;@last@ de @totalItems@ resultados','page':"página",'next':"Siguiente",'nextAria':"Página siguiente",'previous':"Anterior",'previousAria':"Página anterior",'navAria':"Paginación",'lastPageAria':'Ultima página','emptyCategoryError':'Error: Por favor seleccione una o más categorías.','appliedCategories':'Categorías seleccionadas','lifeEventsCategory':'Etapas de la vida','benefitFinderCategory':'Buscador de beneficios','selectionsCleared':'Sus selecciones de categorías fueron reiniciadas.'};}}const ben=new BenefitSearch(benefitsPath,lifeEventsPath,'/themes/custom/usagov',docLang[0],labels,document.querySelector('#benefitSearch'),document.querySelector('#matchingBenefits'),5);await ben.init();});;
var search_input=document.getElementById("search-field-en-small");const dir_search_results=document.getElementById("fed-dir-search-results");let lang=document.documentElement.lang;let search_term="";var allAgencies;function fetchAgencies(){if(lang=="es")return fetch("/sites/default/files/directory_report_federal_es").then((response)=>response.json());else return fetch("/sites/default/files/directory_report_federal").then((response)=>response.json());}function searchAgencies(allAgencies){var returnAgencies=[];var lowerCaseSearchTerm=search_term.toLowerCase();const firstWordExp=new RegExp("^"+lowerCaseSearchTerm+".*");const begWordExp=new RegExp(".* "+lowerCaseSearchTerm);const abbrExp=new RegExp(lowerCaseSearchTerm);allAgencies.forEach((agency)=>{var lowerCaseAgency=agency.agency_title.toLowerCase();if(lowerCaseAgency.match(firstWordExp)||lowerCaseAgency.match(begWordExp))returnAgencies.push(agency);else{if(agency.agency_acronym.toLowerCase().match(abbrExp))returnAgencies.push(agency);};});return returnAgencies;}function showAgencies(filteredAgencies){dir_search_results.innerText="";const usasearch_sayt=document.createElement("div");usasearch_sayt.classList.add("usasearch_sayt");usasearch_sayt.setAttribute("id","usasearch_sayt");const ul=document.createElement("ul");filteredAgencies.forEach((agency,index)=>{const resultBox=document.createElement("li");resultBox.classList.add("resultBox");resultBox.setAttribute("id",`resultBox${index}`);resultBox.setAttribute("role","option");const anchor=document.createElement("a");anchor.onclick=function(){search_input.value=agency.agency_title;};const type=agency.agency_type;if(type=="Federal Directory Record")anchor.href=agency.agency_url;else anchor.href=agency.synonym_url;if(agency.agency_acronym){anchor.innerText=`${agency.agency_title} (${agency.agency_acronym})`;anchor.acronym=agency.agency_acronym;}else anchor.innerText=agency.agency_title;resultBox.appendChild(anchor);ul.appendChild(resultBox);});usasearch_sayt.appendChild(ul);dir_search_results.appendChild(usasearch_sayt);}async function getAgencies(){try{if(!allAgencies)allAgencies=await fetchAgencies();let filteredAgencies=await searchAgencies(allAgencies);await showAgencies(filteredAgencies);}catch(status){}}function listen_for_clear_results(){const fed_dir_results=document.getElementById("usasearch_sayt");if(fed_dir_results)window.addEventListener("click",function(e){if(!fed_dir_results.contains(e.target))dir_search_results.innerText="";});}if(search_input)search_input.addEventListener("input",(e)=>{search_term=e.target.value;if(search_term!="")getAgencies();else dir_search_results.innerText="";listen_for_clear_results();});;
